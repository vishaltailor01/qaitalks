# Cloudflare Pages Configuration for Next.js with D1 Database
name = "qaitalks"
compatibility_date = "2026-02-06"
pages_build_output_dir = ".open-next"

# Required compatibility flags for Next.js
compatibility_flags = ["nodejs_compat", "streams_enable_constructors"]

# KV Namespaces for Rate Limiting and Caching
[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "placeholder_rate_limit_id"  # Replace with: wrangler kv:namespace create RATE_LIMIT

[[kv_namespaces]]
binding = "API_CACHE"
id = "placeholder_api_cache_id"  # Replace with: wrangler kv:namespace create API_CACHE

# Preview Environment KV Namespaces
[[env.preview.kv_namespaces]]
binding = "RATE_LIMIT"
id = "placeholder_rate_limit_preview_id"  # Replace with: wrangler kv:namespace create RATE_LIMIT --preview

[[env.preview.kv_namespaces]]
binding = "API_CACHE"
id = "placeholder_api_cache_preview_id"  # Replace with: wrangler kv:namespace create API_CACHE --preview

# D1 Database - Production
[[d1_databases]]
binding = "DB"
database_name = "qaitalks-db"
database_id = "d1218a37-db81-44a3-9755-58a872f9019e"

# D1 Database - Preview/Staging Environment
[[env.preview.d1_databases]]
binding = "DB"
database_name = "qaitalks-db-preview"
database_id = "d6a74ead-6fc2-4cdd-aaad-b01c0297f7cd"

# Environment variables (add secrets via Cloudflare dashboard)
# Production secrets (main branch):
# - NEXTAUTH_SECRET (wrangler pages secret put NEXTAUTH_SECRET)
# - NEXTAUTH_URL (your production domain)
# - DATABASE_URL (production database)
#
# Preview/Staging secrets (non-production branches):
# - NEXTAUTH_SECRET (wrangler pages secret put NEXTAUTH_SECRET --env preview)
# - NEXTAUTH_URL (staging domain - https://staging.<project>.pages.dev)
# - DATABASE_URL (staging database)
#
# OAuth Providers (all environments):
# - GITHUB_ID, GITHUB_SECRET
# - GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET
